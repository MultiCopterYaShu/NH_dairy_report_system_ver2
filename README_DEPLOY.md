# Render デプロイ手順

このシステムをRenderにデプロイする手順です。

## 1. Renderアカウントの作成

1. [Render](https://render.com) にアクセスしてアカウントを作成
2. GitHubアカウントと連携（推奨）

## 2. リポジトリの準備

1. このプロジェクトをGitHubリポジトリにプッシュ
2. `.gitignore`で`data/*.json`が除外されているため、初期データは`initialize_data()`で自動生成されます

## 3. RenderでWebサービスを作成

1. Renderダッシュボードで「New +」→「Web Service」を選択
2. GitHubリポジトリを接続
3. 以下の設定を行う：

### 基本設定
- **Name**: `daily-report-system`（任意）
- **Environment**: `Python 3`
- **Build Command**: `pip install -r requirements.txt`
- **Start Command**: `gunicorn app:app --bind 0.0.0.0:$PORT`

### 環境変数
以下の環境変数を設定：

- **SECRET_KEY**: ランダムな文字列（例：`openssl rand -hex 32`で生成）
  - セキュリティのため、本番環境では必ず設定してください
- **DATA_DIR**: データディレクトリのパス（オプション）
  - デフォルトは`data`（相対パス）
  - ディスクストレージを使用する場合、通常は設定不要です

### ディスクストレージ（重要）
データファイル（JSON）を永続化するため、ディスクストレージを追加：

1. 「Disk」タブで「Add Disk」をクリック
2. 以下の設定：
   - **Name**: `data-disk`
   - **Mount Path**: `/opt/render/project/src/data`
   - **Size**: 1GB（必要に応じて調整）

**重要**: ディスクストレージのマウントパスは、プロジェクトのルートディレクトリ（`/opt/render/project/src`）からの相対パスで`data`になります。
アプリケーションは相対パス`data`を使用するため、マウントパスを`/opt/render/project/src/data`に設定すれば、自動的にディスクストレージに保存されます。

## 4. デプロイ

1. 「Create Web Service」をクリック
2. デプロイが完了するまで待機（数分かかります）
3. デプロイ完了後、提供されたURLでアクセス

## 5. 初期ログイン

- **ユーザー名**: `admin`
- **パスワード**: `admin`（初回ログイン後、必ず変更してください）

## 注意事項

1. **データの永続化**: ディスクストレージを設定しないと、再デプロイ時にデータが失われます
2. **SECRET_KEY**: 本番環境では必ず強力なSECRET_KEYを設定してください
3. **HTTPS**: Renderは自動的にHTTPSを提供します
4. **環境変数**: 機密情報は環境変数で管理してください

## トラブルシューティング

### デプロイエラー
- `requirements.txt`の依存関係を確認
- ビルドログを確認してエラー内容を確認

### データが保存されない / JSONファイルが読み込めない
- ディスクストレージが正しくマウントされているか確認
  - Renderダッシュボードの「Disk」タブでマウント状態を確認
  - マウントパスが`/opt/render/project/src/data`になっているか確認
- ログを確認して、データディレクトリのパスを確認
  - Renderのログに`[json_manager] データディレクトリを作成しました:`というメッセージが表示されます
- ディスクストレージがマウントされていない場合：
  - ディスクストレージを追加して再デプロイ
  - または、環境変数`DATA_DIR`を設定（通常は不要）

### アプリケーションが起動しない
- ログを確認してエラー内容を確認
- `gunicorn`が正しくインストールされているか確認

